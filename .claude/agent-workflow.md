# 에이전트 협업 워크플로우
# Agent Collaboration Workflow

**최종 업데이트**: 2025-10-22

---

## 개요

이 문서는 **에이전트 중심의 개발자 간 협업 워크플로우**를 정의합니다.

**중요**:
- 이 워크플로우는 **모든 에이전트가 반드시 준수해야 하는 필수 규칙**입니다.
- 사용자가 이 워크플로우를 잊고 있더라도 **에이전트가 능동적으로 챙겨서** 준수해야 합니다.
- 각 개발자는 자신만의 로컬 에이전트와 작업하며, 모든 에이전트는 동일한 워크플로우를 따릅니다.

---

## 에이전트의 책임

### 1. 능동적 워크플로우 관리

에이전트는 다음을 **자동으로** 수행해야 합니다:

- ✅ 모든 작업 시작 전 **반드시 워크플로우 체크**
- ✅ 사용자가 워크플로우를 잊었다면 **자동으로 안내**
- ✅ 사용자가 워크플로우를 따르지 않으려 하면 **부드럽게 재안내**
- ✅ 최소한의 규칙이라도 지키도록 **적극적으로 유도**
- ✅ 워크플로우 변경 요청 시 **팀 논의 필요성 안내**

### 2. 작업 시작 전 필수 체크리스트

```markdown
[ ] `.claude/tasks/` 전체 디렉토리 검색 완료
[ ] 현재 작업이 작업 문서에 정의되어 있는지 확인 완료
[ ] 정의된 작업이라면 해당 문서 리뷰 완료
[ ] 현재 개발자 이름 확인 완료 (git config, 환경변수 등 활용)
[ ] 현재 브랜치 확인 및 브랜치 전략 준수 계획 수립 완료
[ ] 사용자에게 워크플로우 진행 방향 안내 완료
```

---

## 작업 시작 프로세스

### 0단계: 현재 개발자 확인

작업을 시작하기 전, 에이전트는 **현재 작업하는 개발자의 이름을 확인**해야 합니다.

#### 개발자 이름 확인 방법

```bash
# 1. Git 설정에서 확인 (우선순위 1)
git config user.name
# 예: "Yonghyun Kim" 또는 "김용현"

# 2. 시스템 사용자명 확인 (우선순위 2)
whoami
# 예: "yonghyun"

# 3. 홈 디렉토리에서 추론 (우선순위 3)
echo $HOME
# 예: /Users/yonghyun → "yonghyun"
```

#### 개발자 이름 기록 규칙

- **원칙**: 작업 문서의 담당자는 **"Claude"가 아니라 실제 작업을 실행하는 개발자 이름**
- **형식**:
  - 개발자가 요청하고 에이전트가 작성: `개발자이름 (Claude Code)`
  - 개발자가 직접 작성: `개발자이름`
- **예시**:
  - `김용현 (Claude Code)` ✅
  - `Yonghyun Kim (Claude Code)` ✅
  - `Claude Code` ❌ (잘못된 예시)

#### 개발자 이름이 모호한 경우

Git 설정이나 시스템 정보로 개발자 이름을 확실하게 알 수 없다면:

```
"작업 문서에 기록할 담당자 이름을 확인하고 싶습니다.
현재 Git 설정: [git config user.name 결과]
시스템 사용자: [whoami 결과]

이 정보로 '[추론한 이름]'으로 기록하면 될까요?
아니면 다른 이름으로 기록하시겠습니까?"
```

**에이전트는 한 번 확인한 개발자 이름을 세션 동안 기억하고, 이후 작업에서 재사용합니다.**

---

### 1단계: 작업 정의 확인

사용자가 작업을 요청하면, 에이전트는 **가장 먼저** 다음을 수행합니다:

```bash
# .claude/tasks/ 전체 디렉토리 검색
1. Glob 도구로 .claude/tasks/**/*.md 검색
2. 각 작업 문서의 제목, 작업 ID, 상태 확인
3. 현재 요청된 작업과 매칭되는 문서가 있는지 판단
```

#### 케이스 A: 정의된 작업인 경우

```
1. 해당 작업 문서를 Read로 읽기
2. 사용자에게 안내:
   "이 작업은 [파일명]에 이미 정의되어 있습니다.
    해당 문서를 확인하여 기획 내용을 리뷰하고 진행하겠습니다."
3. 문서 내용 리뷰:
   - 목표, 범위, 기술적 접근 확인
   - 관련 파일 확인
   - 불명확하거나 개선할 부분이 있는지 검토
4. 피드백이 있다면:
   - 사용자에게 피드백 내용 공유
   - 사용자 승인 후 문서 업데이트
   - 문서 업데이트 커밋
5. 작업 진행
```

#### 케이스 B: 정의되지 않은 작업인 경우

```
1. 사용자에게 안내:
   "이 작업은 아직 작업 문서에 정의되어 있지 않습니다.
    먼저 기획 및 플래닝을 진행한 후 문서화하겠습니다."
2. 플래닝 진행:
   - 작업 목표 및 범위 정의
   - 기술적 접근 방법 설계
   - 관련 파일 확인
   - 예상되는 이슈 및 해결 방법
3. 문서화:
   - .claude/tasks/template.md를 기반으로 새 작업 문서 생성
   - 파일명: XX-작업명-간략-설명.md (예: 01-add-japanese-language-support.md)
4. 문서 커밋 (별도 커밋):
   - 타입: "docs:"
   - 예: "docs: add task document for Japanese language support"
5. 작업 진행
```

### 2단계: 브랜치 전략 확인

작업 문서 확인 후, [브랜치 전략 문서](branching-strategy.md)를 참고하여 다음을 확인합니다:

```bash
# 현재 브랜치 확인
git branch --show-current

# 판단 기준:
1. 이 작업이 최상위 작업인가? 서브태스크인가?
2. 현재 어떤 브랜치에 있는가?
3. 새 브랜치를 생성해야 하는가?
4. 플래닝 문서를 main에 먼저 커밋해야 하는가?
```

자세한 브랜치 전략은 [branching-strategy.md](branching-strategy.md)를 참조하세요.

### 3단계: 작업 진행

- 코드 작성 시 기존 규칙 준수:
  - POSIX 호환성 ([CLAUDE.md](../CLAUDE.md#코드-작성-규칙))
  - 커밋 규칙 ([commit-guidelines.md](commit-guidelines.md))
- 의미 단위로 커밋
- 작업 문서에 진행 상황 로그 업데이트

### 4단계: 작업 완료

- 작업 문서의 완료 체크리스트 확인
- `make test` 실행
- 작업 문서 최종 업데이트
- PR 생성 및 병합 ([branching-strategy.md](branching-strategy.md) 참조)

---

## 사용자 예외 처리 가이드

### 케이스 1: 사용자가 워크플로우를 잊은 경우

**상황**: 사용자가 작업 문서 확인 없이 바로 작업을 요청함

**에이전트 대응**:
```
"이 작업을 시작하기 전에 `.claude/tasks/`에서 작업 정의를 먼저 확인해야 합니다.
관련 작업 문서가 있는지 검색해드릴까요?"
```

**절대 하지 말아야 할 것**:
- ❌ 사용자가 요청했다고 바로 작업 시작
- ❌ 워크플로우를 건너뛰고 코딩 시작

### 케이스 2: 사용자가 워크플로우 무시를 요청한 경우

**상황**:
- "그냥 바로 시작해"
- "문서 확인 안 해도 돼"
- "빨리 코딩부터 해"

**에이전트 대응 (1차 안내)**:
```
"워크플로우를 건너뛰는 것은 향후 작업 이력 관리에 영향을 줄 수 있습니다.
최소한 다음 항목만 지키는 것은 어떨까요?
1. 작업 문서가 있는지 빠르게 확인
2. 브랜치 전략 준수 (feat/ 브랜치 사용)

이렇게라도 진행하시겠습니까?"
```

**에이전트 대응 (2차 안내 - 사용자가 여전히 거부하는 경우)**:
```
"알겠습니다. 하지만 최소한 브랜치 네이밍은 준수하겠습니다.
작업 완료 후 문서화는 제가 진행하겠습니다."
```

**에이전트가 지켜야 할 최소 규칙**:
- ✅ 브랜치 네이밍 컨벤션 (`feat/`)
- ✅ 커밋 규칙 준수
- ✅ 작업 후 문서 작성 또는 업데이트

### 케이스 3: 사용자가 워크플로우 변경을 원하는 경우

**상황**:
- "이 워크플로우 규칙을 바꾸고 싶어"
- "이 부분은 불필요한 것 같은데 제거하자"

**에이전트 대응**:
```
"워크플로우 변경은 프로젝트 전체에 영향을 미치는 중요한 결정입니다.

다음 절차를 따라주세요:
1. main 브랜치에서 작업
2. 변경 내용을 문서에 반영하고 변경 이력 기록
3. 커밋 후 푸시

현재 브랜치가 main이 아니라면, main으로 이동하시겠습니까?"
```

**현재 브랜치가 main이 아닌 경우**:
```
"현재 브랜치는 [브랜치명]입니다.
워크플로우 변경은 반드시 main 브랜치에서 진행해야 합니다.
main으로 체크아웃하시겠습니까?"
```

---

## 워크플로우 변경 규칙

### 변경 절차

1. **main 브랜치에서 작업**
   ```bash
   git checkout main
   git pull origin main
   ```

2. **문서 수정**
   - 해당 워크플로우 문서 수정
   - 변경 이력 섹션에 기록:
     ```markdown
     ## 변경 이력
     - YYYY-MM-DD: [변경 내용] ([담당자])
     ```

3. **커밋 및 푸시**
   ```bash
   git add .claude/agent-workflow.md  # 또는 해당 파일
   git commit -m "docs: update agent workflow - [변경 사유]"
   git push origin main
   ```

### 변경 금지 사항

❌ **절대 하지 말아야 할 것**:
- 개인 판단으로 워크플로우 변경
- feature 브랜치에서 워크플로우 문서 수정
- 변경 이력 기록 누락

---

## 작업 문서 관리

### 작업 문서 위치

```
.claude/tasks/
├── template.md          # 작업 문서 템플릿
├── README.md            # 작업 문서 구조 설명
├── 01-task-name.md
├── 02-another-task.md
└── ...
```

### 작업 문서 검색 방법

```bash
# 에이전트가 사용하는 명령어
Glob: .claude/tasks/**/*.md

# 또는 Grep으로 키워드 검색
Grep: "상태.*진행 중" in .claude/tasks/**/*.md
```

### 작업 문서 네이밍 규칙

```
XX-작업명-간략-설명.md

예시:
- 01-add-japanese-language-support.md
- 02-improve-env-loading-performance.md
- 03-fix-alias-backup-bug.md
```

---

## 체크리스트

### 작업 시작 시 에이전트 체크리스트

```markdown
[ ] `.claude/tasks/` 디렉토리 검색 완료
[ ] 작업 정의 문서 존재 여부 확인 완료
[ ] 정의된 작업이라면 문서 리뷰 및 피드백 반영 완료
[ ] 정의 안 된 작업이라면 플래닝 및 문서화 완료
[ ] 브랜치 전략 확인 및 적절한 브랜치 체크아웃 완료
[ ] 사용자에게 워크플로우 진행 방향 안내 완료
```

### 작업 진행 중 에이전트 체크리스트

```markdown
[ ] 코드 규칙 준수 (POSIX 호환성)
[ ] 의미 단위로 커밋
[ ] 문서 업데이트는 별도 커밋
[ ] 작업 문서에 진행 상황 로그 기록
```

### 작업 완료 시 에이전트 체크리스트

```markdown
[ ] make test 통과
[ ] 작업 문서 완료 체크리스트 확인
[ ] PR 생성 및 병합 프로세스 진행
[ ] 사용자 승인 확인 (부모 브랜치 병합 시)
```

---

## 자주 묻는 질문 (FAQ)

### Q1: 사용자가 급하게 작업을 요청하면 워크플로우를 건너뛰어도 되나요?

**A**: 아니요. 에이전트는 **반드시** 워크플로우를 준수해야 합니다. 다만, 사용자에게 다음과 같이 안내할 수 있습니다:

```
"급하시다는 것 이해합니다.
작업 문서 확인은 1분이면 충분하며, 이후 작업이 더 효율적으로 진행됩니다.
빠르게 확인하고 시작하겠습니다."
```

### Q2: 작업 문서가 너무 많아서 검색이 어려우면?

**A**: 다음 방법을 사용하세요:

```bash
# 1. 진행 중인 작업만 검색
Grep: "상태.*진행 중" in .claude/tasks/**/*.md

# 2. 키워드로 검색
Grep: "언어 지원" in .claude/tasks/**/*.md
```

### Q3: 문서화가 번거롭다고 사용자가 불평하면?

**A**: 다음과 같이 안내하세요:

```
"문서화는 번거로워 보이지만, 다음과 같은 이점이 있습니다:
1. 작업 중단 후 재개 시 컨텍스트 복원 용이
2. 프로젝트 히스토리 및 기술적 결정 기록 보존
3. 향후 유사 작업 시 참고 자료로 활용

제가 템플릿 기반으로 빠르게 작성하겠습니다."
```

### Q4: 워크플로우가 생산성을 떨어뜨린다고 주장하면?

**A**: 워크플로우 개선을 위한 논의를 제안하세요:

```
"워크플로우 개선은 항상 환영합니다!
더 나은 방향을 찾아보시는 건 어떨까요?
main 브랜치에서 워크플로우 문서를 함께 업데이트할 수 있습니다."
```

---

## 관련 문서

- [브랜치 전략](branching-strategy.md) - 자동화된 브랜치 전략 상세
- [작업 문서 구조](tasks/README.md) - 작업 문서 관리 가이드
- [작업 문서 템플릿](tasks/template.md) - 작업 문서 작성 템플릿
- [커밋 가이드라인](commit-guidelines.md) - Git 커밋 규칙
- [CLAUDE.md](../CLAUDE.md) - 프로젝트 전체 가이드

---

## 변경 이력

- **2025-10-22**: direnv 프로젝트에 맞게 조정 및 적용
- **2025-10-20**: onoffhub-frontend에서 초안 작성

---

**이 워크플로우는 프로젝트 관리 효율성을 위해 모든 에이전트가 반드시 준수해야 합니다.**
